<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>うま恋日記</title>
    <meta name="description" content="競馬予想インフルエンサー専用プロフィールリンク集約サービス">
    
    <!-- Accessibility improvements -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Universal Design Variables */
        :root {
            /* Enhanced color contrast ratios (WCAG AA compliant) */
            --primary-color: #2563eb;
            --secondary-color: #1d4ed8;
            --accent-color: #dc2626;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2625;
            
            /* High contrast text colors */
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --text-muted: #6b7280;
            --text-inverse: #ffffff;
            
            /* Background colors with proper contrast */
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --bg-overlay: rgba(0, 0, 0, 0.5);
            
            /* Horse racing theme gradients */
            --horse-gradient-1: #1e40af;
            --horse-gradient-2: #7c3aed;
            --track-gradient-1: #059669;
            --track-gradient-2: #0d9488;
            
            /* Shadows with better visibility */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
            
            /* Border and spacing */
            --border-color: #e5e7eb;
            --border-focus: #3b82f6;
            --border-error: #ef4444;
            
            /* Font sizes - accessible scaling */
            --font-xs: 0.75rem;
            --font-sm: 0.875rem;
            --font-base: 1rem;
            --font-lg: 1.125rem;
            --font-xl: 1.25rem;
            --font-2xl: 1.5rem;
            --font-3xl: 1.875rem;
            --font-4xl: 2.25rem;
            
            /* High contrast mode support */
            --focus-ring: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            :root {
                --text-primary: #000000;
                --text-secondary: #333333;
                --bg-primary: #ffffff;
                --border-color: #000000;
                --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.8);
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-size: var(--font-base);
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--horse-gradient-1) 0%, var(--horse-gradient-2) 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Skip to content link for screen readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-color);
            color: var(--text-inverse);
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 10000;
            transition: top 0.3s;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* Font size controls */
        .accessibility-controls {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 2000;
            display: flex;
            gap: 8px;
            background: var(--bg-primary);
            padding: 8px;
            border-radius: 8px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .font-control {
            background: var(--primary-color);
            color: var(--text-inverse);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .font-control:hover, .font-control:focus {
            background: var(--secondary-color);
            outline: 2px solid var(--border-focus);
            outline-offset: 2px;
        }

        /* Container with proper landmarks */
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Admin toggle with improved accessibility */
        .admin-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 20px;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-color);
            transition: all 0.3s ease;
            font-size: var(--font-sm);
        }

        .admin-toggle:hover, .admin-toggle:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            outline: 2px solid var(--border-focus);
            outline-offset: 2px;
        }

        /* Profile card with semantic structure */
        .profile-card {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 32px 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            text-align: center;
            transition: all 0.3s ease;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, var(--horse-gradient-1), var(--horse-gradient-2));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-inverse);
            font-size: 48px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            position: relative;
        }

        .profile-avatar:hover, .profile-avatar:focus {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
            outline: 3px solid var(--border-focus);
            outline-offset: 3px;
        }

        .profile-name {
            font-size: var(--font-3xl);
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .profile-description {
            color: var(--text-secondary);
            font-size: var(--font-lg);
            line-height: 1.6;
            margin-bottom: 24px;
        }

        /* Enhanced stats with racing metrics */
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .stat-item {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            background: var(--bg-tertiary);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: var(--font-2xl);
            font-weight: 700;
            color: var(--primary-color);
            display: block;
        }

        .stat-label {
            font-size: var(--font-xs);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 4px;
        }

        /* Racing performance indicators */
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .performance-item {
            background: var(--bg-primary);
            padding: 16px 12px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .performance-number {
            font-size: var(--font-xl);
            font-weight: 700;
            display: block;
            margin-bottom: 4px;
        }

        .performance-number.positive { color: var(--success-color); }
        .performance-number.negative { color: var(--danger-color); }
        .performance-number.neutral { color: var(--primary-color); }

        .performance-label {
            font-size: var(--font-xs);
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Prediction comments section */
        .predictions-section {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: var(--font-2xl);
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-prediction-btn {
            background: var(--success-color);
            color: var(--text-inverse);
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: var(--font-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-prediction-btn:hover, .add-prediction-btn:focus {
            background: var(--warning-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            outline: 2px solid var(--border-focus);
            outline-offset: 2px;
        }

        /* Individual prediction cards */
        .prediction-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
        }

        .prediction-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .prediction-card.hit {
            border-left: 4px solid var(--success-color);
            background: linear-gradient(90deg, rgba(5, 150, 105, 0.1) 0%, var(--bg-secondary) 10%);
        }

        .prediction-card.miss {
            border-left: 4px solid var(--danger-color);
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.1) 0%, var(--bg-secondary) 10%);
        }

        .prediction-card.pending {
            border-left: 4px solid var(--warning-color);
            background: linear-gradient(90deg, rgba(217, 119, 6, 0.1) 0%, var(--bg-secondary) 10%);
        }

        .prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .race-info {
            flex: 1;
        }

        .race-title {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .race-details {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .race-tag {
            background: var(--primary-color);
            color: var(--text-inverse);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: var(--font-xs);
            font-weight: 500;
        }

        .confidence-level {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: var(--font-sm);
            font-weight: 600;
        }

        .confidence-stars {
            color: var(--warning-color);
        }

        .prediction-content {
            margin: 16px 0;
            padding: 16px;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .prediction-text {
            font-size: var(--font-base);
            line-height: 1.7;
            color: var(--text-primary);
            white-space: pre-wrap;
        }

        .prediction-footer {
            display: flex;
            justify-content: between;
            align-items: center;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .prediction-meta {
            font-size: var(--font-sm);
            color: var(--text-muted);
            flex: 1;
        }

        .prediction-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: var(--font-xs);
            transition: all 0.2s ease;
        }

        .action-btn:hover, .action-btn:focus {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            outline: 2px solid var(--border-focus);
            outline-offset: 1px;
        }

        .action-btn.edit { border-color: var(--primary-color); color: var(--primary-color); }
        .action-btn.delete { border-color: var(--danger-color); color: var(--danger-color); }
        .action-btn.result { border-color: var(--success-color); color: var(--success-color); }

        /* Links with racing platform options */
        .links-container {
            margin-bottom: 24px;
        }

        .link-item {
            background: var(--bg-primary);
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .link-item:hover, .link-item:focus-within {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .link-button {
            display: flex;
            align-items: center;
            padding: 16px;
            text-decoration: none;
            color: var(--text-primary);
            width: 100%;
            border: none;
            background: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .link-button:focus {
            outline: 2px solid var(--border-focus);
            outline-offset: 2px;
        }

        .link-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            margin-right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-xl);
            flex-shrink: 0;
            border: 1px solid var(--border-color);
        }

        .link-content {
            flex: 1;
            text-align: left;
        }

        .link-title {
            font-size: var(--font-lg);
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .link-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-sm);
        }

        .link-arrow {
            font-size: var(--font-lg);
            color: var(--text-secondary);
            transition: transform 0.3s ease;
        }

        .link-item:hover .link-arrow {
            transform: translateX(4px);
        }

        /* Racing platform specific styles */
        .link-jra { background: linear-gradient(135deg, #1e40af, #3b82f6); }
        .link-netkeiba { background: linear-gradient(135deg, #059669, #10b981); }
        .link-klan { background: linear-gradient(135deg, #dc2626, #ef4444); }
        .link-keibai { background: linear-gradient(135deg, #7c3aed, #a855f7); }
        .link-youtube { background: linear-gradient(135deg, #dc2626, #ef4444); }
        .link-twitter { background: linear-gradient(135deg, #1d4ed8, #3b82f6); }
        .link-note { background: linear-gradient(135deg, #059669, #10b981); }
        .link-blog { background: linear-gradient(135deg, #ea580c, #f97316); }

        /* Modal improvements */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-overlay);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 32px;
            width: 100%;
            max-width: 480px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: var(--font-2xl);
            font-weight: 700;
            color: var(--text-primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: var(--font-2xl);
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .close-btn:hover, .close-btn:focus {
            background: var(--bg-secondary);
            color: var(--text-primary);
            outline: 2px solid var(--border-focus);
        }

        /* Enhanced form controls */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-sm);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: var(--font-base);
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: var(--focus-ring);
        }

        .form-input:invalid, .form-select:invalid, .form-textarea:invalid {
            border-color: var(--border-error);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-buttons {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: var(--font-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:focus {
            outline: 2px solid var(--border-focus);
            outline-offset: 2px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--text-inverse);
        }

        .btn-primary:hover, .btn-primary:focus {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover, .btn-secondary:focus {
            color: var(--text-primary);
            border-color: var(--text-secondary);
            background: var(--bg-secondary);
        }

        .btn-success {
            background: var(--success-color);
            color: var(--text-inverse);
        }

        .btn-danger {
            background: var(--danger-color);
            color: var(--text-inverse);
        }

        /* Add link button */
        .add-link-btn {
            width: 100%;
            padding: 20px;
            background: var(--bg-primary);
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            color: var(--primary-color);
            font-size: var(--font-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .add-link-btn:hover, .add-link-btn:focus {
            border-color: var(--primary-color);
            background: var(--bg-secondary);
            transform: translateY(-2px);
            outline: 2px solid var(--border-focus);
            outline-offset: 2px;
        }

        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus visible improvements */
        .focus-visible {
            outline: 2px solid var(--border-focus);
            outline-offset: 2px;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .accessibility-controls {
                position: relative;
                top: auto;
                left: auto;
                margin-bottom: 16px;
                justify-content: center;
            }
            
            .admin-toggle {
                top: 16px;
                right: 16px;
                padding: 10px 16px;
                font-size: var(--font-sm);
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .performance-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 24px;
                margin: 16px;
            }
            
            .prediction-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .prediction-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
        }

        /* Print styles */
        @media print {
            .admin-toggle,
            .accessibility-controls,
            .add-prediction-btn,
            .add-link-btn,
            .prediction-actions,
            .admin-only {
                display: none !important;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .profile-card,
            .predictions-section,
            .link-item {
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }

        /* Animation classes */
        .loading {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .admin-only {
            display: none;
        }

        .admin-mode .admin-only {
            display: block;
        }

        /* Error states */
        .error-message {
            color: var(--danger-color);
            font-size: var(--font-sm);
            margin-top: 4px;
        }

        .success-message {
            color: var(--success-color);
            font-size: var(--font-sm);
            margin-top: 4px;
        }

        /* Tooltip styles */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: var(--text-inverse);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: var(--font-sm);
            white-space: nowrap;
            z-index: 1000;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --text-primary: #f9fafb;
                --text-secondary: #d1d5db;
                --text-muted: #9ca3af;
                --bg-primary: #1f2937;
                --bg-secondary: #374151;
                --bg-tertiary: #4b5563;
                --border-color: #4b5563;
            }
        }
    </style>
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">メインコンテンツへスキップ</a>

    <!-- Accessibility controls -->
    <div class="accessibility-controls" role="region" aria-label="アクセシビリティ設定">
        <button class="font-control" onclick="adjustFontSize(-1)" aria-label="文字サイズを小さく" title="文字サイズを小さく">A-</button>
        <button class="font-control" onclick="adjustFontSize(0)" aria-label="文字サイズをリセット" title="文字サイズをリセット">A</button>
        <button class="font-control" onclick="adjustFontSize(1)" aria-label="文字サイズを大きく" title="文字サイズを大きく">A+</button>
    </div>

    <!-- Admin toggle -->
    <button class="admin-toggle" onclick="toggleAdmin()" aria-label="管理モード切り替え">
        <span id="admin-text">管理モード</span>
    </button>

    <div class="container">
        <main id="main-content" class="main-content">
            <!-- Profile section -->
            <section class="profile-card loading" aria-labelledby="profile-heading">
                <div class="profile-avatar" onclick="selectAvatar()" role="button" tabindex="0" aria-label="プロフィール画像を変更" onkeydown="handleKeyPress(event, selectAvatar)">
                    <span id="avatar-text" aria-hidden="true">🐎</span>
                    <input type="file" id="avatar-input" accept="image/*" style="display: none;" aria-describedby="avatar-help">
                    <span id="avatar-help" class="sr-only">JPEGまたはPNG形式の画像を選択してください</span>
                </div>
                
                <h1 id="profile-heading" class="profile-name" contenteditable="false" id="profile-name" role="heading" aria-level="1">
                    うま恋日記
                </h1>
                
                <p class="profile-description" contenteditable="false" id="profile-description">
                    競馬のある週末が好きです。パドックでの一瞬の表情や、静かな直線の駆け引きに惹かれます。データも直感も大切に、気ままに予想や感想を綴ります。#競馬好きと繋がりたい
                </p>

                <!-- Racing performance stats -->
                <div class="performance-grid" role="region" aria-label="予想成績">
                    <div class="performance-item">
                        <span class="performance-number positive" id="hit-rate">68.5%</span>
                        <div class="performance-label">的中率</div>
                    </div>
                    <div class="performance-item">
                        <span class="performance-number positive" id="roi">+245</span>
                        <div class="performance-label">収支</div>
                    </div>
                    <div class="performance-item">
                        <span class="performance-number neutral" id="total-races">156</span>
                        <div class="performance-label">総レース数</div>
                    </div>
                    <div class="performance-item">
                        <span class="performance-number positive" id="streak">8</span>
                        <div class="performance-label">連勝記録</div>
                    </div>
                </div>

                <div class="profile-stats" role="region" aria-label="統計情報">
                    <div class="stat-item">
                        <span class="stat-number" id="total-links">0</span>
                        <span class="stat-label">リンク数</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="total-views">0</span>
                        <span class="stat-label">総閲覧数</span>
                    </div>
                </div>
            </section>

            <!-- Predictions section -->
            <section class="predictions-section loading" aria-labelledby="predictions-heading">
                <div class="section-header">
                    <h2 id="predictions-heading" class="section-title">
                        🏇 最新予想
                    </h2>
                    <button class="add-prediction-btn admin-only" onclick="openPredictionModal()" aria-label="新しい予想を追加">
                        ➕ 予想追加
                    </button>
                </div>
                
                <div id="predictions-container" role="region" aria-label="予想一覧">
                    <!-- Predictions will be dynamically inserted here -->
                </div>
            </section>

            <!-- Add link button (Admin only) -->
            <button class="add-link-btn admin-only loading" onclick="openAddLinkModal()" aria-label="新しいリンクを追加">
                ➕ リンクを追加
            </button>

            <!-- Links section -->
            <section class="links-container" aria-labelledby="links-heading">
                <h2 id="links-heading" class="sr-only">関連リンク</h2>
                <div id="links-container" role="list">
                    <!-- Links will be dynamically inserted here -->
                </div>
            </section>
        </main>
    </div>

    <!-- Prediction modal -->
    <div class="modal" id="prediction-modal" role="dialog" aria-labelledby="prediction-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="prediction-modal-title" class="modal-title">予想を追加</h3>
                <button class="close-btn" onclick="closePredictionModal()" aria-label="モーダルを閉じる">&times;</button>
            </div>
            <form id="prediction-form" novalidate>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="race-date">開催日</label>
                        <input type="date" class="form-input" id="race-date" required aria-describedby="race-date-error">
                        <div id="race-date-error" class="error-message" role="alert"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="race-venue">競馬場</label>
                        <select class="form-select" id="race-venue" required aria-describedby="race-venue-error">
                            <option value="">選択してください</option>
                            <option value="tokyo">東京</option>
                            <option value="kyoto">京都</option>
                            <option value="hanshin">阪神</option>
                            <option value="nakayama">中山</option>
                            <option value="kokura">小倉</option>
                            <option value="niigata">新潟</option>
                            <option value="hakodate">函館</option>
                            <option value="sapporo">札幌</option>
                            <option value="chukyo">中京</option>
                            <option value="fukushima">福島</option>
                        </select>
                        <div id="race-venue-error" class="error-message" role="alert"></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="race-number">レース番号</label>
                        <select class="form-select" id="race-number" required>
                            <option value="">選択</option>
                            <option value="1">1R</option>
                            <option value="2">2R</option>
                            <option value="3">3R</option>
                            <option value="4">4R</option>
                            <option value="5">5R</option>
                            <option value="6">6R</option>
                            <option value="7">7R</option>
                            <option value="8">8R</option>
                            <option value="9">9R</option>
                            <option value="10">10R</option>
                            <option value="11">11R</option>
                            <option value="12">12R</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="confidence">自信度</label>
                        <select class="form-select" id="confidence" required>
                            <option value="">選択</option>
                            <option value="1">★☆☆☆☆ (様子見)</option>
                            <option value="2">★★☆☆☆ (軽め)</option>
                            <option value="3">★★★☆☆ (普通)</option>
                            <option value="4">★★★★☆ (自信あり)</option>
                            <option value="5">★★★★★ (勝負レース)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="race-name">レース名（オプション）</label>
                    <input type="text" class="form-input" id="race-name" placeholder="例：日本ダービー、有馬記念">
                </div>

                <div class="form-group">
                    <label class="form-label" for="prediction-text">予想内容</label>
                    <textarea class="form-textarea" id="prediction-text" placeholder="本命、対抗、穴馬などの予想と根拠を記入してください..." required aria-describedby="prediction-text-help"></textarea>
                    <div id="prediction-text-help" class="sr-only">予想の根拠や注目ポイントを詳しく記入してください</div>
                </div>

                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closePredictionModal()">キャンセル</button>
                    <button type="submit" class="btn btn-primary" id="save-prediction-btn">
                        <span>💾</span> 予想を保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Link modal -->
    <div class="modal" id="link-modal" role="dialog" aria-labelledby="link-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="link-modal-title" class="modal-title">リンクを追加</h3>
                <button class="close-btn" onclick="closeLinkModal()" aria-label="モーダルを閉じる">&times;</button>
            </div>
            <form id="link-form" novalidate>
                <div class="form-group">
                    <label class="form-label" for="link-platform">プラットフォーム</label>
                    <select class="form-select" id="link-platform" onchange="updateLinkPreview()" required>
                        <option value="">選択してください</option>
                        <option value="jra">JRA公式</option>
                        <option value="netkeiba">netkeiba</option>
                        <option value="klan">競馬ランキング</option>
                        <option value="keibai">地方競馬</option>
                        <option value="youtube">YouTube</option>
                        <option value="twitter">Twitter</option>
                        <option value="note">note</option>
                        <option value="blog">ブログ</option>
                        <option value="custom">カスタム</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="link-title">タイトル</label>
                    <input type="text" class="form-input" id="link-title" placeholder="リンクのタイトル" oninput="updateLinkPreview()" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="link-subtitle">説明（オプション）</label>
                    <input type="text" class="form-input" id="link-subtitle" placeholder="短い説明" oninput="updateLinkPreview()">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="link-url">URL</label>
                    <input type="url" class="form-input" id="link-url" placeholder="https://example.com" oninput="updateLinkPreview()" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="link-icon">アイコン (絵文字)</label>
                    <input type="text" class="form-input" id="link-icon" placeholder="🔗" maxlength="2" oninput="updateLinkPreview()">
                </div>
                
                <!-- Link Preview -->
                <div class="form-group">
                    <label class="form-label">プレビュー</label>
                    <div class="link-item" id="link-preview" role="img" aria-label="リンクプレビュー">
                        <div class="link-button">
                            <div class="link-icon" id="preview-icon">🔗</div>
                            <div class="link-content">
                                <div class="link-title" id="preview-title">リンクタイトル</div>
                                <div class="link-subtitle" id="preview-subtitle">説明文</div>
                            </div>
                            <div class="link-arrow">→</div>
                        </div>
                    </div>
                </div>

                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeLinkModal()">キャンセル</button>
                    <button type="submit" class="btn btn-primary" id="save-link-btn">
                        <span>💾</span> 保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Result modal -->
    <div class="modal" id="result-modal" role="dialog" aria-labelledby="result-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="result-modal-title" class="modal-title">結果を入力</h3>
                <button class="close-btn" onclick="closeResultModal()" aria-label="モーダルを閉じる">&times;</button>
            </div>
            <form id="result-form">
                <div class="form-group">
                    <label class="form-label" for="result-status">結果</label>
                    <select class="form-select" id="result-status" required>
                        <option value="">選択してください</option>
                        <option value="hit">🎯 的中</option>
                        <option value="miss">❌ 不的中</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="result-comment">結果コメント（オプション）</label>
                    <textarea class="form-textarea" id="result-comment" placeholder="結果についてのコメント..."></textarea>
                </div>

                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeResultModal()">キャンセル</button>
                    <button type="submit" class="btn btn-success">
                        <span>✅</span> 結果を保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global state
        let isAdminMode = false;
        let editingPredictionId = null;
        let editingLinkId = null;
        let editingResultId = null;
        let predictionsData = [];
        let linksData = [];
        let profileData = {
            name: '競馬予想師 山田太郎',
            description: '的中率重視の堅実予想で皆様の競馬ライフをサポート。地方・中央問わず幅広く予想を提供しています。',
            avatar: '🐎',
            hitRate: 68.5,
            roi: 245,
            totalRaces: 156,
            streak: 8
        };
        let analyticsData = {
            totalViews: 1,
            totalClicks: 0
        };

        // Font size state
        let currentFontSize = 1;
        const fontSizes = [0.875, 1, 1.125, 1.25, 1.375];

        // Platform configurations for racing sites
        const platformConfig = {
            jra: { icon: '🏇', defaultTitle: 'JRA公式', color: '#1e40af' },
            netkeiba: { icon: '🐎', defaultTitle: 'netkeiba', color: '#059669' },
            klan: { icon: '🏆', defaultTitle: '競馬ランキング', color: '#dc2626' },
            keibai: { icon: '🏁', defaultTitle: '地方競馬', color: '#7c3aed' },
            youtube: { icon: '🎥', defaultTitle: 'YouTube', color: '#dc2626' },
            twitter: { icon: '🐦', defaultTitle: 'Twitter', color: '#1d4ed8' },
            note: { icon: '📝', defaultTitle: 'note', color: '#059669' },
            blog: { icon: '📰', defaultTitle: 'ブログ', color: '#ea580c' },
            custom: { icon: '🔗', defaultTitle: 'カスタムリンク', color: '#6366f1' }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            renderProfile();
            renderPredictions();
            renderLinks();
            updateStats();
            
            // Increment view count
            analyticsData.totalViews++;
            saveData();
            
            // Add loading animation
            setTimeout(() => {
                document.querySelectorAll('.loading').forEach((el, index) => {
                    setTimeout(() => {
                        el.style.opacity = '1';
                        el.style.transform = 'translateY(0)';
                    }, index * 100);
                });
            }, 100);

            // Add sample data if empty
            if (predictionsData.length === 0) {
                addSamplePredictions();
            }
            if (linksData.length === 0) {
                addSampleLinks();
            }
        });

        // Accessibility functions
        function adjustFontSize(direction) {
            if (direction === 0) {
                currentFontSize = 1; // Reset
            } else {
                const newIndex = Math.max(0, Math.min(fontSizes.length - 1, fontSizes.indexOf(fontSizes[currentFontSize]) + direction));
                currentFontSize = fontSizes[newIndex];
            }
            
            document.documentElement.style.fontSize = currentFontSize + 'rem';
            
            // Announce change to screen readers
            announceToScreenReader(`文字サイズを${direction === 1 ? '大きく' : direction === -1 ? '小さく' : 'リセット'}しました`);
        }

        function announceToScreenReader(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.textContent = message;
            document.body.appendChild(announcement);
            
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
        }

        function handleKeyPress(event, callback) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                callback();
            }
        }

        // Data persistence
        function saveData() {
            localStorage.setItem('horselinks_profile', JSON.stringify(profileData));
            localStorage.setItem('horselinks_predictions', JSON.stringify(predictionsData));
            localStorage.setItem('horselinks_links', JSON.stringify(linksData));
            localStorage.setItem('horselinks_analytics', JSON.stringify(analyticsData));
        }

        function loadData() {
            const savedProfile = localStorage.getItem('horselinks_profile');
            const savedPredictions = localStorage.getItem('horselinks_predictions');
            const savedLinks = localStorage.getItem('horselinks_links');
            const savedAnalytics = localStorage.getItem('horselinks_analytics');
            
            if (savedProfile) {
                profileData = { ...profileData, ...JSON.parse(savedProfile) };
            }
            if (savedPredictions) {
                predictionsData = JSON.parse(savedPredictions);
            }
            if (savedLinks) {
                linksData = JSON.parse(savedLinks);
            }
            if (savedAnalytics) {
                analyticsData = { ...analyticsData, ...JSON.parse(savedAnalytics) };
            }
        }

        // Admin mode toggle
        function toggleAdmin() {
            isAdminMode = !isAdminMode;
            document.body.classList.toggle('admin-mode', isAdminMode);
            document.getElementById('admin-text').textContent = isAdminMode ? '表示モード' : '管理モード';
            
            // Update ARIA states
            document.querySelectorAll('.admin-only').forEach(el => {
                el.setAttribute('aria-hidden', !isAdminMode);
            });
            
            if (isAdminMode) {
                enableEditMode();
                announceToScreenReader('管理モードが有効になりました');
            } else {
                disableEditMode();
                announceToScreenReader('表示モードに切り替わりました');
            }
        }

        function enableEditMode() {
            document.getElementById('profile-name').contentEditable = true;
            document.getElementById('profile-description').contentEditable = true;
            
            // Add save listeners
            document.getElementById('profile-name').addEventListener('blur', saveProfileData);
            document.getElementById('profile-description').addEventListener('blur', saveProfileData);
        }

        function disableEditMode() {
            document.getElementById('profile-name').contentEditable = false;
            document.getElementById('profile-description').contentEditable = false;
        }

        function saveProfileData() {
            profileData.name = document.getElementById('profile-name').textContent;
            profileData.description = document.getElementById('profile-description').textContent;
            saveData();
        }

        // Profile rendering
        function renderProfile() {
            document.getElementById('profile-name').textContent = profileData.name;
            document.getElementById('profile-description').textContent = profileData.description;
            document.getElementById('avatar-text').textContent = profileData.avatar;
            
            // Update performance stats
            document.getElementById('hit-rate').textContent = profileData.hitRate + '%';
            document.getElementById('roi').textContent = (profileData.roi >= 0 ? '+' : '') + profileData.roi;
            document.getElementById('total-races').textContent = profileData.totalRaces;
            document.getElementById('streak').textContent = profileData.streak;
            
            // Update stat colors
            document.getElementById('hit-rate').className = 'performance-number ' + (profileData.hitRate >= 60 ? 'positive' : 'negative');
            document.getElementById('roi').className = 'performance-number ' + (profileData.roi >= 0 ? 'positive' : 'negative');
        }

        // Predictions management
        function renderPredictions() {
            const container = document.getElementById('predictions-container');
            container.innerHTML = '';
            
            if (predictionsData.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <p>まだ予想が投稿されていません。</p>
                        ${isAdminMode ? '<p>「予想追加」ボタンから最初の予想を投稿しましょう。</p>' : ''}
                    </div>
                `;
                return;
            }
            
            // Sort predictions by date (newest first)
            const sortedPredictions = [...predictionsData].sort((a, b) => new Date(b.raceDate) - new Date(a.raceDate));
            
            sortedPredictions.forEach((prediction, index) => {
                const predictionElement = createPredictionElement(prediction, index);
                container.appendChild(predictionElement);
            });
        }

        function createPredictionElement(prediction, index) {
            const predictionDiv = document.createElement('article');
            predictionDiv.className = `prediction-card ${prediction.result || 'pending'}`;
            predictionDiv.setAttribute('data-id', prediction.id);
            
            const confidenceStars = '★'.repeat(prediction.confidence) + '☆'.repeat(5 - prediction.confidence);
            const raceDate = new Date(prediction.raceDate).toLocaleDateString('ja-JP');
            const resultIcon = prediction.result === 'hit' ? '🎯' : prediction.result === 'miss' ? '❌' : '⏳';
            const resultText = prediction.result === 'hit' ? '的中' : prediction.result === 'miss' ? '不的中' : '結果待ち';
            
            predictionDiv.innerHTML = `
                <div class="prediction-header">
                    <div class="race-info">
                        <h3 class="race-title">
                            ${prediction.raceName || `${prediction.venue}${prediction.raceNumber}R`}
                        </h3>
                        <div class="race-details">
                            <span class="race-tag">${raceDate}</span>
                            <span class="race-tag">${prediction.venue}</span>
                            <span class="race-tag">${prediction.raceNumber}R</span>
                            <span class="race-tag">${resultIcon} ${resultText}</span>
                        </div>
                    </div>
                    <div class="confidence-level" aria-label="自信度 ${prediction.confidence}点">
                        <span class="confidence-stars">${confidenceStars}</span>
                    </div>
                </div>
                
                <div class="prediction-content">
                    <div class="prediction-text">${prediction.content}</div>
                </div>
                
                <div class="prediction-footer">
                    <div class="prediction-meta">
                        投稿日時: ${new Date(prediction.createdAt).toLocaleString('ja-JP')}
                        ${prediction.resultComment ? `<br>結果コメント: ${prediction.resultComment}` : ''}
                    </div>
                    <div class="prediction-actions admin-only">
                        ${!prediction.result ? `<button class="action-btn result" onclick="openResultModal('${prediction.id}')" aria-label="結果を入力">結果入力</button>` : ''}
                        <button class="action-btn edit" onclick="editPrediction('${prediction.id}')" aria-label="予想を編集">編集</button>
                        <button class="action-btn delete" onclick="deletePrediction('${prediction.id}')" aria-label="予想を削除">削除</button>
                    </div>
                </div>
            `;
            
            return predictionDiv;
        }

        // Prediction modal functions
        function openPredictionModal() {
            editingPredictionId = null;
            document.getElementById('prediction-modal-title').textContent = '予想を追加';
            document.getElementById('save-prediction-btn').innerHTML = '<span>💾</span> 予想を保存';
            clearPredictionForm();
            showModal('prediction-modal');
        }

        function editPrediction(predictionId) {
            editingPredictionId = predictionId;
            const prediction = predictionsData.find(p => p.id === predictionId);
            
            document.getElementById('prediction-modal-title').textContent = '予想を編集';
            document.getElementById('save-prediction-btn').innerHTML = '<span>✏️</span> 予想を更新';
            
            // Populate form
            document.getElementById('race-date').value = prediction.raceDate;
            document.getElementById('race-venue').value = prediction.venue;
            document.getElementById('race-number').value = prediction.raceNumber;
            document.getElementById('race-name').value = prediction.raceName || '';
            document.getElementById('confidence').value = prediction.confidence;
            document.getElementById('prediction-text').value = prediction.content;
            
            showModal('prediction-modal');
        }

        function closePredictionModal() {
            hideModal('prediction-modal');
            clearPredictionForm();
        }

        function clearPredictionForm() {
            document.getElementById('prediction-form').reset();
            clearFormErrors();
        }

        // Result modal functions
        function openResultModal(predictionId) {
            editingResultId = predictionId;
            document.getElementById('result-form').reset();
            showModal('result-modal');
        }

        function closeResultModal() {
            hideModal('result-modal');
            editingResultId = null;
        }

        // Form submission handlers
        document.getElementById('prediction-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validatePredictionForm()) {
                return;
            }
            
            const formData = new FormData(e.target);
            const predictionData = {
                id: editingPredictionId || generateId(),
                raceDate: document.getElementById('race-date').value,
                venue: document.getElementById('race-venue').value,
                raceNumber: document.getElementById('race-number').value,
                raceName: document.getElementById('race-name').value,
                confidence: parseInt(document.getElementById('confidence').value),
                content: document.getElementById('prediction-text').value,
                createdAt: editingPredictionId ? predictionsData.find(p => p.id === editingPredictionId).createdAt : Date.now(),
                updatedAt: Date.now()
            };
            
            if (editingPredictionId) {
                const index = predictionsData.findIndex(p => p.id === editingPredictionId);
                predictionsData[index] = { ...predictionsData[index], ...predictionData };
                announceToScreenReader('予想が更新されました');
            } else {
                predictionsData.push(predictionData);
                announceToScreenReader('新しい予想が追加されました');
            }
            
            saveData();
            renderPredictions();
            updateStats();
            closePredictionModal();
        });

        document.getElementById('result-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const result = document.getElementById('result-status').value;
            const comment = document.getElementById('result-comment').value;
            
            if (!result) {
                showError('result-status', '結果を選択してください');
                return;
            }
            
            const predictionIndex = predictionsData.findIndex(p => p.id === editingResultId);
            if (predictionIndex !== -1) {
                predictionsData[predictionIndex].result = result;
                predictionsData[predictionIndex].resultComment = comment;
                predictionsData[predictionIndex].updatedAt = Date.now();
                
                // Update performance stats
                updatePerformanceStats();
                
                saveData();
                renderPredictions();
                renderProfile();
                announceToScreenReader(`結果が${result === 'hit' ? '的中' : '不的中'}として登録されました`);
            }
            
            closeResultModal();
        });

        function updatePerformanceStats() {
            const totalPredictions = predictionsData.filter(p => p.result).length;
            const hits = predictionsData.filter(p => p.result === 'hit').length;
            
            if (totalPredictions > 0) {
                profileData.hitRate = Math.round((hits / totalPredictions) * 1000) / 10;
                profileData.totalRaces = totalPredictions;
                
                // Calculate streak (consecutive hits from latest)
                let streak = 0;
                const sortedWithResults = predictionsData
                    .filter(p => p.result)
                    .sort((a, b) => new Date(b.raceDate) - new Date(a.raceDate));
                
                for (const prediction of sortedWithResults) {
                    if (prediction.result === 'hit') {
                        streak++;
                    } else {
                        break;
                    }
                }
                
                profileData.streak = streak;
            }
        }

        function deletePrediction(predictionId) {
            if (confirm('この予想を削除しますか？')) {
                predictionsData = predictionsData.filter(p => p.id !== predictionId);
                updatePerformanceStats();
                saveData();
                renderPredictions();
                renderProfile();
                updateStats();
                announceToScreenReader('予想が削除されました');
            }
        }

        // Links management (similar to previous implementation but with racing platforms)
        function renderLinks() {
            const container = document.getElementById('links-container');
            container.innerHTML = '';
            
            linksData.forEach((link, index) => {
                const linkElement = createLinkElement(link, index);
                container.appendChild(linkElement);
            });
            
            updateStats();
        }

        function createLinkElement(link, index) {
            const linkDiv = document.createElement('div');
            linkDiv.className = 'link-item';
            linkDiv.setAttribute('data-id', link.id);
            linkDiv.setAttribute('role', 'listitem');
            
            const platform = platformConfig[link.platform] || platformConfig.custom;
            
            linkDiv.innerHTML = `
                <a href="${link.url}" class="link-button" target="_blank" rel="noopener noreferrer" onclick="handleLinkClick('${link.id}')" aria-describedby="link-desc-${link.id}">
                    <div class="link-icon link-${link.platform}" style="background: ${platform.color}; color: white;">
                        ${link.icon || platform.icon}
                    </div>
                    <div class="link-content">
                        <div class="link-title">${link.title}</div>
                        ${link.subtitle ? `<div class="link-subtitle" id="link-desc-${link.id}">${link.subtitle}</div>` : ''}
                    </div>
                    <div class="link-arrow" aria-hidden="true">→</div>
                </a>
                <div class="prediction-actions admin-only" style="position: absolute; top: 8px; right: 8px; display: none;">
                    <button class="action-btn edit" onclick="editLink('${link.id}')" aria-label="リンクを編集">編集</button>
                    <button class="action-btn delete" onclick="deleteLink('${link.id}')" aria-label="リンクを削除">削除</button>
                </div>
            `;
            
            // Show admin controls on hover in admin mode
            if (isAdminMode) {
                linkDiv.addEventListener('mouseenter', () => {
                    linkDiv.querySelector('.prediction-actions').style.display = 'flex';
                });
                linkDiv.addEventListener('mouseleave', () => {
                    linkDiv.querySelector('.prediction-actions').style.display = 'none';
                });
            }
            
            return linkDiv;
        }

        function handleLinkClick(linkId) {
            if (isAdminMode) return;
            
            analyticsData.totalClicks++;
            saveData();
            updateStats();
        }

        // Link modal functions (similar to previous implementation)
        function openAddLinkModal() {
            editingLinkId = null;
            document.getElementById('link-modal-title').textContent = 'リンクを追加';
            document.getElementById('save-link-btn').innerHTML = '<span>💾</span> 保存';
            clearLinkForm();
            showModal('link-modal');
        }

        function editLink(linkId) {
            editingLinkId = linkId;
            const link = linksData.find(l => l.id === linkId);
            
            document.getElementById('link-modal-title').textContent = 'リンクを編集';
            document.getElementById('save-link-btn').innerHTML = '<span>✏️</span> 更新';
            
            // Populate form
            document.getElementById('link-platform').value = link.platform;
            document.getElementById('link-title').value = link.title;
            document.getElementById('link-subtitle').value = link.subtitle || '';
            document.getElementById('link-url').value = link.url;
            document.getElementById('link-icon').value = link.icon || '';
            
            updateLinkPreview();
            showModal('link-modal');
        }

        function closeLinkModal() {
            hideModal('link-modal');
            clearLinkForm();
        }

        function clearLinkForm() {
            document.getElementById('link-form').reset();
            updateLinkPreview();
            clearFormErrors();
        }

        function updateLinkPreview() {
            const platform = document.getElementById('link-platform').value;
            const title = document.getElementById('link-title').value;
            const subtitle = document.getElementById('link-subtitle').value;
            const icon = document.getElementById('link-icon').value;
            
            const config = platformConfig[platform] || platformConfig.custom;
            const previewTitle = title || config.defaultTitle;
            const previewIcon = icon || config.icon;
            
            document.getElementById('preview-title').textContent = previewTitle;
            document.getElementById('preview-subtitle').textContent = subtitle;
            document.getElementById('preview-icon').textContent = previewIcon;
            
            const previewIconEl = document.getElementById('preview-icon');
            previewIconEl.style.background = config.color;
            previewIconEl.style.color = 'white';
        }

        document.getElementById('link-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateLinkForm()) {
                return;
            }
            
            const platform = document.getElementById('link-platform').value;
            const title = document.getElementById('link-title').value;
            const subtitle = document.getElementById('link-subtitle').value;
            const url = document.getElementById('link-url').value;
            const icon = document.getElementById('link-icon').value;
            
            const linkData = {
                id: editingLinkId || generateId(),
                platform,
                title,
                subtitle,
                url,
                icon: icon || platformConfig[platform].icon,
                createdAt: editingLinkId ? linksData.find(l => l.id === editingLinkId).createdAt : Date.now()
            };
            
            if (editingLinkId) {
                const index = linksData.findIndex(l => l.id === editingLinkId);
                linksData[index] = linkData;
                announceToScreenReader('リンクが更新されました');
            } else {
                linksData.push(linkData);
                announceToScreenReader('新しいリンクが追加されました');
            }
            
            saveData();
            renderLinks();
            closeLinkModal();
        });

        function deleteLink(linkId) {
            if (confirm('このリンクを削除しますか？')) {
                linksData = linksData.filter(l => l.id !== linkId);
                saveData();
                renderLinks();
                announceToScreenReader('リンクが削除されました');
            }
        }

        // Form validation
        function validatePredictionForm() {
            clearFormErrors();
            let isValid = true;
            
            const raceDate = document.getElementById('race-date').value;
            const venue = document.getElementById('race-venue').value;
            const raceNumber = document.getElementById('race-number').value;
            const confidence = document.getElementById('confidence').value;
            const content = document.getElementById('prediction-text').value;
            
            if (!raceDate) {
                showError('race-date', '開催日を選択してください');
                isValid = false;
            }
            
            if (!venue) {
                showError('race-venue', '競馬場を選択してください');
                isValid = false;
            }
            
            if (!raceNumber) {
                showError('race-number', 'レース番号を選択してください');
                isValid = false;
            }
            
            if (!confidence) {
                showError('confidence', '自信度を選択してください');
                isValid = false;
            }
            
            if (!content.trim()) {
                showError('prediction-text', '予想内容を入力してください');
                isValid = false;
            }
            
            return isValid;
        }

        function validateLinkForm() {
            clearFormErrors();
            let isValid = true;
            
            const platform = document.getElementById('link-platform').value;
            const title = document.getElementById('link-title').value;
            const url = document.getElementById('link-url').value;
            
            if (!platform) {
                showError('link-platform', 'プラットフォームを選択してください');
                isValid = false;
            }
            
            if (!title.trim()) {
                showError('link-title', 'タイトルを入力してください');
                isValid = false;
            }
            
            if (!url.trim()) {
                showError('link-url', 'URLを入力してください');
                isValid = false;
            } else if (!isValidUrl(url)) {
                showError('link-url', '有効なURLを入力してください');
                isValid = false;
            }
            
            return isValid;
        }

        function showError(fieldId, message) {
            const field = document.getElementById(fieldId);
            field.classList.add('error');
            field.setAttribute('aria-invalid', 'true');
            
            const errorElement = document.getElementById(fieldId + '-error') || createErrorElement(fieldId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        function createErrorElement(fieldId) {
            const errorDiv = document.createElement('div');
            errorDiv.id = fieldId + '-error';
            errorDiv.className = 'error-message';
            errorDiv.setAttribute('role', 'alert');
            
            const field = document.getElementById(fieldId);
            field.parentNode.insertBefore(errorDiv, field.nextSibling);
            
            return errorDiv;
        }

        function clearFormErrors() {
            document.querySelectorAll('.form-input, .form-select, .form-textarea').forEach(field => {
                field.classList.remove('error');
                field.removeAttribute('aria-invalid');
            });
            
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
                error.textContent = '';
            });
        }

        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // Modal management
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            
            // Focus management
            const firstFocusable = modal.querySelector('input, select, textarea, button');
            if (firstFocusable) {
                firstFocusable.focus();
            }
            
            // Trap focus within modal
            trapFocus(modal);
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
        }

        function trapFocus(element) {
            const focusableElements = element.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstFocusable = focusableElements[0];
            const lastFocusable = focusableElements[focusableElements.length - 1];

            element.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstFocusable) {
                            lastFocusable.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastFocusable) {
                            firstFocusable.focus();
                            e.preventDefault();
                        }
                    }
                }
                
                if (e.key === 'Escape') {
                    hideModal(element.id);
                }
            });
        }

        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function updateStats() {
            document.getElementById('total-links').textContent = linksData.length;
            document.getElementById('total-views').textContent = analyticsData.totalViews;
        }

        // Sample data
        function addSamplePredictions() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            predictionsData = [
                {
                    id: 'sample-pred-1',
                    raceDate: tomorrow.toISOString().split('T')[0],
                    venue: '東京',
                    raceNumber: '11',
                    raceName: '東京大賞典',
                    confidence: 4,
                    content: '本命: 5番 ◯◯◯◯\n対抗: 3番 △△△△\n穴馬: 8番 ××××\n\n東京大賞典は例年波乱が多いレースですが、今年は5番が中心。前走の内容が抜けており、距離適性も申し分なし。3番は安定感抜群で連対候補筆頭。8番は人気薄ながら末脚に光るものがあり、3着狙いで面白い存在。',
                    createdAt: Date.now() - 3600000,
                    result: 'hit',
                    resultComment: '本命5番が見事に勝利！予想通りの展開でした。'
                },
                {
                    id: 'sample-pred-2',
                    raceDate: today.toISOString().split('T')[0],
                    venue: '中山',
                    raceNumber: '9',
                    confidence: 3,
                    content: '本命: 2番 ●●●●\n対抗: 7番 ▲▲▲▲\n\n中山9Rは2番を軸に組み立て。前走の負け方に好材料が多く、今回は巻き返しが期待できる。7番は実績上位で安定感がある。',
                    createdAt: Date.now() - 7200000
                }
            ];
            saveData();
        }

        function addSampleLinks() {
            linksData = [
                {
                    id: 'sample-link-1',
                    platform: 'youtube',
                    title: 'YouTube予想チャンネル',
                    subtitle: '毎日の予想動画を配信中',
                    url: 'https://youtube.com',
                    icon: '🎥',
                    createdAt: Date.now()
                },
                {
                    id: 'sample-link-2',
                    platform: 'twitter',
                    title: 'Twitter',
                    subtitle: 'リアルタイム予想と結果報告',
                    url: 'https://twitter.com',
                    icon: '🐦',
                    createdAt: Date.now()
                },
                {
                    id: 'sample-link-3',
                    platform: 'netkeiba',
                    title: 'netkeiba予想',
                    subtitle: '詳細な競馬データと予想',
                    url: 'https://netkeiba.com',
                    icon: '🐎',
                    createdAt: Date.now()
                }
            ];
            saveData();
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            // Close modals with Escape
            if (e.key === 'Escape') {
                const activeModal = document.querySelector('.modal.active');
                if (activeModal) {
                    hideModal(activeModal.id);
                }
            }
            
            // Admin mode toggle with Ctrl+A
            if (e.key === 'a' && e.ctrlKey) {
                e.preventDefault();
                toggleAdmin();
            }
        });

        // Close modal when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    hideModal(this.id);
                }
            });
        });
    </script>
</body>
</html>
